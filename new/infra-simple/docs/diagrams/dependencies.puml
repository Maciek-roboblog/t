@startuml dependencies
!theme plain
skinparam backgroundColor white
skinparam defaultFontName Helvetica
skinparam roundCorner 8
skinparam shadowing false

skinparam package {
    BackgroundColor #FAFAFA
    BorderColor #BDBDBD
}

skinparam component {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
}

skinparam database {
    BackgroundColor #E8F5E9
    BorderColor #388E3C
}

skinparam artifact {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
}

title Service Dependencies

package "External" {
    database "MLflow" as mlflow
    database "NFS" as nfs
    cloud "GCR" as gcr
    component "vLLM" as vllm #E8F5E9
}

package "Docker" {
    artifact "llama-factory-train" as image {
        component "LLaMA-Factory 0.9.3"
        component "PyTorch 2.1.2"
        component "MLflow client"
    }
}

package "Kubernetes" {
    component "WebUI" as webui
    component "Training Job" as train
    component "Merge Job" as merge
    database "PVC" as pvc
    file "ConfigMap" as config
    file "Secret" as secret
}

' Image flow
image --> gcr : push
gcr --> webui : pull
gcr --> train : pull
gcr --> merge : pull

' Config
config --> webui
config --> train
config --> merge
secret --> train : MLFLOW_URI

' Storage
pvc --> nfs : backend
pvc --> webui
pvc --> train
pvc --> merge

' External
train ..> mlflow : metrics
nfs --> vllm : /models/merged

@enduml
